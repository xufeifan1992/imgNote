# 负载均衡-轮询



*nginx默认负载均衡策略为轮询*



### 加权轮询策略

```shell
#配置上游服务器  weight越高 权重越大
upstream tomcats {
 server 192.168.133.130:8080 weight =1; 
 server 192.168.133.131:8080 weight =2;
}
```





### upstream指令参数



* max_conns    *限制服务器最大连接数，配置到upstram中，根据服务器能承受的最大流量，进行过载保护，默认值为0，表示没有限制*
* slow_start    * *
* down
* backup
* max_fails
* fail_timeout





```shell
# worker进程设置1个，便于测试观察成功的连接数
worker_processes  1;

upstream tomcats {
        server 192.168.1.173:8080 max_conns=2;
        server 192.168.1.174:8080 max_conns=2;
        server 192.168.1.175:8080 max_conns=2;
}


```



```shell
upstream tomcats {
        server 192.168.1.173:8080 weight=6 slow_start=60s;
#       server 192.168.1.190:8080;
        server 192.168.1.174:8080 weight=2;
        server 192.168.1.175:8080 weight=2;
}

注意

    该参数不能使用在hash和random load balancing中。
    如果在 upstream 中只有一台 server，则该参数失效。


```



```shell
down 用于标记服务节点不可用：

upstream tomcats {
        server 192.168.1.173:8080 down;
#       server 192.168.1.190:8080;
        server 192.168.1.174:8080 weight=1;
        server 192.168.1.175:8080 weight=1;
}

backup表示当前服务器节点是备用机，只有在其他的服务器都宕机以后，自己才会加入到集群中，被用户访问到：

upstream tomcats {
        server 192.168.1.173:8080 backup;
#       server 192.168.1.190:8080;
        server 192.168.1.174:8080 weight=1;
        server 192.168.1.175:8080 weight=1;
}

注意

    backup参数不能使用在hash和random load balancing中。


```

